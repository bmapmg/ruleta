<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruleta Millonaria</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #0f0c29;
            background: linear-gradient(to bottom, #24243e, #302b63, #0f0c29);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .wheel-container {
            position: relative;
            width: 95vw;
            max-width: 450px;
            aspect-ratio: 1/1;
            margin-top: 10px;
        }

        .marker {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff0000;
            filter: drop-shadow(0 0 10px rgba(255,0,0,0.5));
            z-index: 10;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            cursor: grab;
        }

        #result {
            margin-top: 25px;
            font-size: 1.8rem;
            min-height: 50px;
            text-align: center;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }

        h2 { margin: 0; color: #fff; text-transform: uppercase; letter-spacing: 2px; }
        p { color: #aaa; font-size: 0.8rem; margin-bottom: 5px; }
    </style>
</head>
<body>

    <h2>Ruleta de la Fortuna</h2>
    <p>Desliza con fuerza para girar</p>

    <div class="wheel-container">
        <div class="marker"></div>
        <canvas id="wheelCanvas" width="800" height="800"></canvas>
    </div>

    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const resultDiv = document.getElementById('result');

        // Configuración de Premios (24 en total)
        const prizes = [
            "1 MILLÓN", "Vacío", "100 mil", "Vacío", "200 mil", "Vacío",
            "100 mil", "Vacío", "500 mil", "Vacío", "100 mil", "Vacío",
            "200 mil", "Vacío", "100 mil", "Vacío", "Vacío", "Vacío",
            "Vacío", "Vacío", "Vacío", "Vacío", "Vacío", "Vacío"
        ];

        const totalSegments = prizes.length;
        const arc = 2 * Math.PI / totalSegments;
        let currentAngle = 0;
        let isDragging = false;
        let startAngle = 0;
        let velocity = 0;
        let lastTime = 0;
        let lastSegmentIndex = -1;

        // --- MOTOR DE SONIDO (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTickSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playWinSound() {
            const notes = [523.25, 659.25, 783.99, 1046.50]; // Acorde de Do mayor
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + (i * 0.1));
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime + (i * 0.1));
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + (i * 0.1) + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + (i * 0.1));
                osc.stop(audioCtx.currentTime + (i * 0.1) + 0.5);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, 800, 800);
            prizes.forEach((prize, i) => {
                const angle = i * arc + currentAngle;
                
                // Fondo
                ctx.beginPath();
                ctx.fillStyle = (prize === "Vacío") ? (i % 2 === 0 ? "#1e1e2f" : "#2a2a40") : "#ffd700";
                ctx.moveTo(400, 400);
                ctx.arc(400, 400, 400, angle, angle + arc);
                ctx.lineTo(400, 400);
                ctx.fill();
                ctx.strokeStyle = "rgba(255,255,255,0.1)";
                ctx.stroke();

                // Texto
                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = (prize === "Vacío") ? "#555" : "#000";
                ctx.font = prize.includes("MILLÓN") ? "bold 26px Arial" : "bold 18px Arial";
                ctx.fillText(prize, 380, 8);
                ctx.restore();
            });

            // Detectar si pasamos por un nuevo segmento para el sonido
            const currentSegment = Math.floor(((2 * Math.PI - (currentAngle % (2 * Math.PI))) % (2 * Math.PI)) / arc);
            if (currentSegment !== lastSegmentIndex && Math.abs(velocity) > 0.001) {
                playTickSound();
                lastSegmentIndex = currentSegment;
            }
        }

        function getMouseAngle(ev) {
            const rect = canvas.getBoundingClientRect();
            const x = (ev.touches ? ev.touches[0].clientX : ev.clientX) - (rect.left + rect.width / 2);
            const y = (ev.touches ? ev.touches[0].clientY : ev.clientY) - (rect.top + rect.height / 2);
            return Math.atan2(y, x);
        }

        const startAction = (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isDragging = true;
            velocity = 0;
            resultDiv.innerText = "";
            startAngle = getMouseAngle(e) - currentAngle;
            lastTime = performance.now();
        };

        const moveAction = (e) => {
            if (!isDragging) return;
            const newAngle = getMouseAngle(e);
            const now = performance.now();
            velocity = (newAngle - startAngle - currentAngle) / (now - lastTime);
            currentAngle = newAngle - startAngle;
            lastTime = now;
            draw();
        };

        const endAction = () => {
            if (!isDragging) return;
            isDragging = false;
            const friction = 0.985;
            function animate() {
                if (Math.abs(velocity) < 0.0005) {
                    calculatePrize();
                    return;
                }
                currentAngle += velocity * 16;
                velocity *= friction;
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        };

        function calculatePrize() {
            const normalizedAngle = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
            const winningIndex = Math.floor(((2 * Math.PI - normalizedAngle + (1.5 * Math.PI)) % (2 * Math.PI)) / arc);
            const finalPrize = prizes[winningIndex];
            
            if (finalPrize !== "Vacío") {
                resultDiv.innerText = "¡GANASTE: $" + finalPrize + "!";
                playWinSound();
            } else {
                resultDiv.innerText = "Sigue intentando...";
            }
        }

        canvas.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);
        canvas.addEventListener('touchstart', startAction);
        window.addEventListener('touchmove', moveAction);
        window.addEventListener('touchend', endAction);

        draw();
    </script>
</body>
</html>
