<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruleta de la Suerte</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #121212;
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .wheel-container {
            position: relative;
            width: 90vw;
            max-width: 480px;
            aspect-ratio: 1/1;
        }

        .marker {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid #ff0000;
            z-index: 10;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            cursor: grab;
        }

        #result {
            margin-top: 20px;
            font-size: 2.2rem;
            min-height: 60px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
        }

        .instruction { color: #888; margin-bottom: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="instruction">Desliza para girar la ruleta</div>

    <div class="wheel-container">
        <div class="marker"></div>
        <canvas id="wheelCanvas" width="900" height="900"></canvas>
    </div>

    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const resultDiv = document.getElementById('result');

        // DefiniciÃ³n de premios y vacÃ­os siguiendo tu lÃ³gica exacta
        // Pares (Ã­ndice 1, 3, 5... en JS) -> VacÃ­os Blancos
        // Impares (Ã­ndice 0, 2, 4... en JS) -> Premios o VacÃ­os extra
        const wheelData = [
            { label: "1 MILLÃ“N", color: "#FFD700", text: "#000", value: 1000000 }, // 1 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 2 (Par)
            { label: "500 MIL", color: "#00D2FF", text: "#000", value: 500000 },  // 3 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 4 (Par)
            { label: "200 MIL", color: "#27AE60", text: "#fff", value: 200000 },  // 5 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 6 (Par)
            { label: "200 MIL", color: "#27AE60", text: "#fff", value: 200000 },  // 7 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 8 (Par)
            { label: "100 MIL", color: "#E67E22", text: "#fff", value: 100000 },  // 9 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 10 (Par)
            { label: "100 MIL", color: "#E67E22", text: "#fff", value: 100000 },  // 11 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 12 (Par)
            { label: "100 MIL", color: "#E67E22", text: "#fff", value: 100000 },  // 13 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 14 (Par)
            { label: "100 MIL", color: "#E67E22", text: "#fff", value: 100000 },  // 15 (Impar)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 16 (Par)
            { label: "ðŸ˜¢", color: "#333333", text: "#555", value: 0 },            // 17 (Impar - Extra VacÃ­o)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 18 (Par)
            { label: "ðŸ˜¢", color: "#333333", text: "#555", value: 0 },            // 19 (Impar - Extra VacÃ­o)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 20 (Par)
            { label: "ðŸ˜¢", color: "#333333", text: "#555", value: 0 },            // 21 (Impar - Extra VacÃ­o)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 },             // 22 (Par)
            { label: "ðŸ˜¢", color: "#333333", text: "#555", value: 0 },            // 23 (Impar - Extra VacÃ­o)
            { label: "ðŸ˜¢", color: "#FFFFFF", text: "#000", value: 0 }              // 24 (Par)
        ];

        const totalSegments = wheelData.length;
        const arc = 2 * Math.PI / totalSegments;
        let currentAngle = 0;
        let isDragging = false;
        let startAngle = 0;
        let velocity = 0;
        let lastTime = 0;
        let lastTickSegment = -1;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTickSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.04);
            gain.gain.setValueAtTime(0.06, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.04);
        }

        function playWinSound() {
            [440, 554, 659, 880].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.5);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, 900, 900);
            wheelData.forEach((item, i) => {
                const angle = i * arc + currentAngle;
                
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(450, 450);
                ctx.arc(450, 450, 440, angle, angle + arc);
                ctx.lineTo(450, 450);
                ctx.fill();
                ctx.strokeStyle = "rgba(0,0,0,0.2)";
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(450, 450);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = item.text;
                ctx.font = "bold 20px Arial";
                ctx.fillText(item.label, 420, 10);
                ctx.restore();
            });

            // LÃ³gica de sonido al girar
            const currentSegment = Math.floor(((2 * Math.PI - (currentAngle % (2 * Math.PI))) % (2 * Math.PI)) / arc);
            if (currentSegment !== lastTickSegment && Math.abs(velocity) > 0.001) {
                playTickSound();
                lastTickSegment = currentSegment;
            }
        }

        const getMouseAngle = (ev) => {
            const rect = canvas.getBoundingClientRect();
            const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
            const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
            return Math.atan2(clientY - (rect.top + rect.height/2), clientX - (rect.left + rect.width/2));
        };

        const startAction = (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isDragging = true;
            velocity = 0;
            resultDiv.innerText = "";
            startAngle = getMouseAngle(e) - currentAngle;
            lastTime = performance.now();
        };

        const moveAction = (e) => {
            if (!isDragging) return;
            const newAngle = getMouseAngle(e);
            const now = performance.now();
            velocity = (newAngle - startAngle - currentAngle) / (now - lastTime);
            currentAngle = newAngle - startAngle;
            lastTime = now;
            draw();
        };

        const endAction = () => {
            if (!isDragging) return;
            isDragging = false;
            const friction = 0.99; 
            function animate() {
                if (Math.abs(velocity) < 0.0003) {
                    calculatePrize();
                    return;
                }
                currentAngle += velocity * 16;
                velocity *= friction;
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        };

        function calculatePrize() {
            const normalizedAngle = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
            const winningIndex = Math.floor(((2 * Math.PI - normalizedAngle + (1.5 * Math.PI)) % (2 * Math.PI)) / arc);
            const prize = wheelData[winningIndex];
            
            if (prize.value > 0) {
                resultDiv.style.color = prize.color === "#FFFFFF" ? "#000" : prize.color;
                resultDiv.innerText = "Â¡GANASTE $" + prize.label + "!";
                playWinSound();
            } else {
                resultDiv.style.color = "#888";
                resultDiv.innerText = "Â¡SUERTE PARA LA PRÃ“XIMA! ðŸ˜¢";
            }
        }

        canvas.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);
        canvas.addEventListener('touchstart', startAction);
        window.addEventListener('touchmove', moveAction);
        window.addEventListener('touchend', endAction);

        draw();
    </script>
</body>
</html>
