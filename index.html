<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruleta Aleatoria</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #0a0a0a;
            color: white;
            font-family: 'Arial Black', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .wheel-container {
            position: relative;
            width: 92vw;
            max-width: 480px;
            aspect-ratio: 1/1;
        }

        .marker {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff0000;
            z-index: 10;
            filter: drop-shadow(0 0 10px gold);
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #222;
            cursor: grab;
        }

        #result {
            margin-top: 25px;
            font-size: 2rem;
            min-height: 50px;
            text-align: center;
            color: #ffd700;
        }

        .sub-text { font-family: sans-serif; color: #666; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="sub-text">GIRA PARA GANAR</div>

    <div class="wheel-container">
        <div class="marker"></div>
        <canvas id="wheelCanvas" width="900" height="900"></canvas>
    </div>

    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const resultDiv = document.getElementById('result');

        // Lista de premios solicitada
        const poolPremios = [
            { label: "1 MILL√ìN", color: "#FFD700", val: 1000000 },
            { label: "500 MIL", color: "#00E5FF", val: 500000 },
            { label: "200 MIL", color: "#2ECC71", val: 200000 },
            { label: "200 MIL", color: "#2ECC71", val: 200000 },
            { label: "100 MIL", color: "#E67E22", val: 100000 },
            { label: "100 MIL", color: "#E67E22", val: 100000 },
            { label: "100 MIL", color: "#E67E22", val: 100000 },
            { label: "100 MIL", color: "#E67E22", val: 100000 },
            { label: "50 MIL", color: "#9B59B6", val: 50000 },
            { label: "50 MIL", color: "#9B59B6", val: 50000 },
            { label: "10 MIL", color: "#F1C40F", val: 10000 },
            { label: "10 MIL", color: "#F1C40F", val: 10000 }
        ];

        // Funci√≥n para mezclar los premios aleatoriamente
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const premiosMezclados = shuffle([...poolPremios]);

        // Construir la ruleta final: Impar = Premio, Par = üò¢ Blanco
        const wheelData = [];
        let premioIndex = 0;
        for (let i = 1; i <= 24; i++) {
            if (i % 2 !== 0) {
                wheelData.push(premiosMezclados[premioIndex]);
                premioIndex++;
            } else {
                wheelData.push({ label: "üò¢", color: "#FFFFFF", val: 0, text: "#000" });
            }
        }

        const totalSegments = wheelData.length;
        const arc = 2 * Math.PI / totalSegments;
        let currentAngle = 0;
        let isDragging = false;
        let startAngle = 0;
        let velocity = 0;
        let lastTime = 0;
        let lastTickSegment = -1;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTickSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.04);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.04);
        }

        function playWinSound() {
            [523, 659, 783].forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.4);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.1); osc.stop(audioCtx.currentTime + i * 0.1 + 0.4);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, 900, 900);
            wheelData.forEach((item, i) => {
                const angle = i * arc + currentAngle;
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(450, 450);
                ctx.arc(450, 450, 440, angle, angle + arc);
                ctx.lineTo(450, 450);
                ctx.fill();
                ctx.save();
                ctx.translate(450, 450);
                ctx.rotate(angle + arc/2);
                ctx.textAlign = "right";
                ctx.fillStyle = item.val > 0 ? (item.val === 1000000 ? "#000" : "#fff") : "#000";
                ctx.font = "bold 20px Arial";
                ctx.fillText(item.label, 420, 10);
                ctx.restore();
            });

            const currentSegment = Math.floor(((2 * Math.PI - (currentAngle % (2 * Math.PI))) % (2 * Math.PI)) / arc);
            if (currentSegment !== lastTickSegment && Math.abs(velocity) > 0.001) {
                playTickSound();
                lastTickSegment = currentSegment;
            }
        }

        const getMouseAngle = (ev) => {
            const rect = canvas.getBoundingClientRect();
            const cx = ev.touches ? ev.touches[0].clientX : ev.clientX;
            const cy = ev.touches ? ev.touches[0].clientY : ev.clientY;
            return Math.atan2(cy - (rect.top + rect.height/2), cx - (rect.left + rect.width/2));
        };

        const startAction = (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isDragging = true;
            resultDiv.innerText = "";
            startAngle = getMouseAngle(e) - currentAngle;
            lastTime = performance.now();
        };

        const moveAction = (e) => {
            if (!isDragging) return;
            const newAngle = getMouseAngle(e);
            const now = performance.now();
            velocity = (newAngle - startAngle - currentAngle) / (now - lastTime);
            currentAngle = newAngle - startAngle;
            lastTime = now;
            draw();
        };

        const endAction = () => {
            if (!isDragging) return;
            isDragging = false;
            const friction = 0.99;
            function animate() {
                if (Math.abs(velocity) < 0.0003) {
                    const normalized = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
                    const idx = Math.floor(((2 * Math.PI - normalized + (1.5 * Math.PI)) % (2 * Math.PI)) / arc);
                    const win = wheelData[idx];
                    if (win.val > 0) {
                        resultDiv.innerText = "¬°GANASTE $" + win.label + "!";
                        playWinSound();
                    } else {
                        resultDiv.innerText = "M√ÅS SUERTE LA PR√ìXIMA üò¢";
                    }
                    return;
                }
                currentAngle += velocity * 16;
                velocity *= friction;
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        };

        canvas.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);
        canvas.addEventListener('touchstart', startAction);
        window.addEventListener('touchmove', moveAction);
        window.addEventListener('touchend', endAction);

        draw();
    </script>
</body>
</html>
