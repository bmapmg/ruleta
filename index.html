<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruleta Premium</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #050510;
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .wheel-container {
            position: relative;
            width: 92vw;
            max-width: 480px;
            aspect-ratio: 1/1;
        }

        .marker {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-top: 35px solid #ff3e3e;
            filter: drop-shadow(0 0 8px rgba(255,0,0,0.8));
            z-index: 10;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 6px solid #444;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
            cursor: grab;
        }

        #result {
            margin-top: 20px;
            font-size: 2rem;
            min-height: 60px;
            text-align: center;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .info { color: #666; font-size: 0.8rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;}
    </style>
</head>
<body>

    <div class="info">Desliza con fuerza la ruleta</div>

    <div class="wheel-container">
        <div class="marker"></div>
        <canvas id="wheelCanvas" width="900" height="900"></canvas>
    </div>

    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const resultDiv = document.getElementById('result');

        // Configuración de Premios (24 en total, distribuidos aleatoriamente)
        const wheelData = [
            { label: "1 MILLÓN", color: "#FFD700", text: "#000", value: 1000000 }, // Oro
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "100 mil", color: "#E67E22", text: "#fff", value: 100000 }, // Naranja
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "200 mil", color: "#27AE60", text: "#fff", value: 200000 }, // Verde
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "100 mil", color: "#E67E22", text: "#fff", value: 100000 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "500 mil", color: "#00D2FF", text: "#000", value: 500000 }, // Cian/Plata
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "100 mil", color: "#E67E22", text: "#fff", value: 100000 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "200 mil", color: "#27AE60", text: "#fff", value: 200000 },
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "100 mil", color: "#E67E22", text: "#fff", value: 100000 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 },
            { label: "Vacío", color: "#1a1a2e", text: "#444", value: 0 },
            { label: "Vacío", color: "#16213e", text: "#444", value: 0 }
        ];

        const totalSegments = wheelData.length;
        const arc = 2 * Math.PI / totalSegments;
        let currentAngle = 0;
        let isDragging = false;
        let startAngle = 0;
        let velocity = 0;
        let lastTime = 0;
        let lastSegmentIndex = -1;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTickSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.05);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        function playWinSound() {
            const freqs = [523, 659, 783, 1046];
            freqs.forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.4);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.4);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, 900, 900);
            wheelData.forEach((item, i) => {
                const angle = i * arc + currentAngle;
                
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(450, 450);
                ctx.arc(450, 450, 440, angle, angle + arc);
                ctx.lineTo(450, 450);
                ctx.fill();

                ctx.save();
                ctx.translate(450, 450);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = item.text;
                ctx.font = item.value >= 500000 ? "bold 24px sans-serif" : "16px sans-serif";
                if (item.label !== "Vacío") {
                    ctx.fillText(item.label, 420, 8);
                }
                ctx.restore();
            });

            const currentSegment = Math.floor(((2 * Math.PI - (currentAngle % (2 * Math.PI))) % (2 * Math.PI)) / arc);
            if (currentSegment !== lastSegmentIndex && Math.abs(velocity) > 0.001) {
                playTickSound();
                lastSegmentIndex = currentSegment;
            }
        }

        const getMouseAngle = (ev) => {
            const rect = canvas.getBoundingClientRect();
            const x = (ev.touches ? ev.touches[0].clientX : ev.clientX) - (rect.left + rect.width / 2);
            const y = (ev.touches ? ev.touches[0].clientY : ev.clientY) - (rect.top + rect.height / 2);
            return Math.atan2(y, x);
        };

        const startAction = (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isDragging = true;
            velocity = 0;
            resultDiv.innerText = "";
            startAngle = getMouseAngle(e) - currentAngle;
            lastTime = performance.now();
        };

        const moveAction = (e) => {
            if (!isDragging) return;
            const newAngle = getMouseAngle(e);
            const now = performance.now();
            velocity = (newAngle - startAngle - currentAngle) / (now - lastTime);
            currentAngle = newAngle - startAngle;
            lastTime = now;
            draw();
        };

        const endAction = () => {
            if (!isDragging) return;
            isDragging = false;
            const friction = 0.988;
            function animate() {
                if (Math.abs(velocity) < 0.0004) {
                    calculatePrize();
                    return;
                }
                currentAngle += velocity * 16;
                velocity *= friction;
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        };

        function calculatePrize() {
            const normalizedAngle = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
            const winningIndex = Math.floor(((2 * Math.PI - normalizedAngle + (1.5 * Math.PI)) % (2 * Math.PI)) / arc);
            const prize = wheelData[winningIndex];
            
            if (prize.value > 0) {
                resultDiv.style.color = prize.color;
                resultDiv.innerText = "GANASTE: $" + prize.label;
                playWinSound();
            } else {
                resultDiv.style.color = "#666";
                resultDiv.innerText = "Inténtalo de nuevo";
            }
        }

        canvas.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);
        canvas.addEventListener('touchstart', startAction);
        window.addEventListener('touchmove', moveAction);
        window.addEventListener('touchend', endAction);

        draw();
    </script>
</body>
</html>
