<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruleta T√°ctil</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #1a1a2e;
            color: white;
            font-family: sans-serif;
            overflow: hidden;
            touch-action: none; /* Evita que la pantalla se mueva al girar */
        }

        .wheel-container {
            position: relative;
            width: 90vw;
            max-width: 400px;
            aspect-ratio: 1/1;
        }

        .marker {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #e74c3c;
            z-index: 10;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            cursor: grab;
        }

        #result {
            margin-top: 20px;
            font-size: 1.5rem;
            height: 40px;
            text-align: center;
            color: #f1c40f;
            font-weight: bold;
        }

        p { color: #888; font-size: 0.9rem; }
    </style>
</head>
<body>

    <p>Desliza para girar</p>
    <div class="wheel-container">
        <div class="marker"></div>
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
    </div>
    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const resultDiv = document.getElementById('result');

        const prizes = ["üéÅ Premiazo", "üç¶ Helado", "‚≠ê 5 Puntos", "‚ùå Nada", "üéüÔ∏è Ticket", "üç¨ Dulce", "üî• Bonus", "üíÄ Casi"];
        const colors = ['#f1c40f', '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71', '#1abc9c', '#34495e'];
        
        const totalSegments = prizes.length;
        const arc = 2 * Math.PI / totalSegments;

        let currentAngle = 0;
        let isDragging = false;
        let startAngle = 0;
        let velocity = 0;
        let lastAngle = 0;
        let lastTime = 0;

        function draw() {
            ctx.clearRect(0, 0, 500, 500);
            prizes.forEach((prize, i) => {
                const angle = i * arc + currentAngle;
                ctx.beginPath();
                ctx.fillStyle = colors[i];
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 250, angle, angle + arc);
                ctx.lineTo(250, 250);
                ctx.fill();

                ctx.save();
                ctx.translate(250, 250);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 22px Arial";
                ctx.fillText(prize, 230, 10);
                ctx.restore();
            });
        }

        function getMouseAngle(ev) {
            const rect = canvas.getBoundingClientRect();
            const x = (ev.touches ? ev.touches[0].clientX : ev.clientX) - (rect.left + rect.width / 2);
            const y = (ev.touches ? ev.touches[0].clientY : ev.clientY) - (rect.top + rect.height / 2);
            return Math.atan2(y, x);
        }

        // Iniciar toque
        const startAction = (e) => {
            isDragging = true;
            velocity = 0;
            resultDiv.innerText = "";
            startAngle = getMouseAngle(e) - currentAngle;
            lastTime = performance.now();
        };

        // Mover dedo
        const moveAction = (e) => {
            if (!isDragging) return;
            const newAngle = getMouseAngle(e);
            const now = performance.now();
            
            // Calcular velocidad para el impulso final
            velocity = (newAngle - startAngle - currentAngle) / (now - lastTime);
            
            currentAngle = newAngle - startAngle;
            lastTime = now;
            draw();
        };

        // Soltar
        const endAction = () => {
            if (!isDragging) return;
            isDragging = false;
            
            // Animaci√≥n de frenado (fricci√≥n)
            const friction = 0.98;
            function animate() {
                if (Math.abs(velocity) < 0.001) {
                    calculatePrize();
                    return;
                }
                currentAngle += velocity * 16; // Multiplicador de velocidad
                velocity *= friction;
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        };

        function calculatePrize() {
            // El marcador est√° arriba (270 grados o -PI/2 radianes)
            const normalizedAngle = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
            const winningIndex = Math.floor(((2 * Math.PI - normalizedAngle + (1.5 * Math.PI)) % (2 * Math.PI)) / arc);
            resultDiv.innerText = "¬°Ganaste: " + prizes[winningIndex] + "!";
        }

        canvas.addEventListener('mousedown', startAction);
        window.addEventListener('mousemove', moveAction);
        window.addEventListener('mouseup', endAction);

        canvas.addEventListener('touchstart', startAction);
        window.addEventListener('touchmove', moveAction);
        window.addEventListener('touchend', endAction);

        draw();
    </script>
</body>
</html>
